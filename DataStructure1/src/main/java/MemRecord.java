import java.awt.Color;
import javax.swing.JOptionPane;
import javax.swing.JPanel;
import java.io.BufferedReader;
import java.io.File;
import java.io.IOException;
import java.io.FileNotFoundException;
import java.io.FileReader;
import java.io.FileWriter;
import java.time.LocalDate;
import java.time.Period;
import java.util.LinkedList;
import java.util.Scanner;
import javax.swing.RowFilter;
import javax.swing.table.DefaultTableModel;
import javax.swing.table.TableRowSorter;

/*
 * Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
 * Click nbfs://nbhost/SystemFileSystem/Templates/GUIForms/JFrame.java to edit this template
 */
/**
 *
 * @author Ryan's PC
 */
public class MemRecord extends javax.swing.JFrame {

    /**
     * Creates new form MemRecord
     */
    public MemRecord() {
        initComponents();
        setLocationRelativeTo(null);//set the page location 
        setResizable(false);//disable the resizable function
        
        dtm = (DefaultTableModel) MemRecordTable.getModel();
        
        memRec = new LinkedList();
        
        try {
            File file = new File("memberRecord.txt");
            if (file.createNewFile()) {
                System.out.println("File created: " + file.getName());
            } else {
                System.out.println("File already exists.");
            }
        } catch (IOException e) {
            System.out.println("An error occured.");
            e.printStackTrace();
        }
        
        now = LocalDate.now();
        dayNow = now.getDayOfMonth();
        monthNow = now.getMonthValue();
        yearNow = now.getYear();
        
        try {
            File myObj = new File("memberRecord.txt");
            Scanner scanner = new Scanner(myObj);
            while (scanner.hasNextLine()) {
                line = scanner.nextLine();
                lineSplit = line.split("___");
                dob = lineSplit[2];
                dobLDFormatString = DMYtoYMD(dob);
                dobLDFormat = LocalDate.parse(dobLDFormatString);
                ageP = Period.between(dobLDFormat, now);
                ageInt = ageP.getYears();
                age = String.valueOf(ageInt);
                
                status = lineSplit[9];
                expDate = lineSplit[10];
                expDateYMD = DMYtoYMD(expDate);
                expDateLD = LocalDate.parse(expDateYMD);
                expDateDay = expDateLD.getDayOfMonth();
                expDateMonth = expDateLD.getMonthValue();
                expDateYear = expDateLD.getYear();
                if (expDateYear > yearNow) {
                
                } else if (expDateYear == yearNow && expDateMonth > monthNow) {
                    
                } else if (expDateYear == yearNow && expDateMonth == monthNow && expDateDay >= dayNow) {
                
                } else {
                    status = "INACTIVE";
                }
                
                memRec.add(new MemRecord(lineSplit[0], lineSplit[1], lineSplit[2], age, lineSplit[4], lineSplit[5], lineSplit[6], lineSplit[7], lineSplit[8], status, lineSplit[10]));
            }
            scanner.close();
        } catch (FileNotFoundException e) {
            System.out.println("An error occured.");
            e.printStackTrace();
        }
        
        for(MemRecord mr: memRec) {
            lineSplit = mr.toString().split("___");
            dtm.addRow(lineSplit);
        }
        
        try {
            FileWriter myWriter = new FileWriter("memberRecord.txt");
            for (MemRecord mr: memRec) {
                myWriter.write(mr.toString() + "\n");
            }
            myWriter.close();
        } catch (IOException e) {
            System.out.println("An error occured.");
            e.printStackTrace();
        }
        
        sorter = new TableRowSorter(dtm);
        MemRecordTable.setRowSorter(sorter);
    }
    
    

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jPanel1 = new javax.swing.JPanel();
        pnlMemRecord = new javax.swing.JPanel();
        jLabel1 = new javax.swing.JLabel();
        Search = new javax.swing.JTextField();
        RefreshBtn = new javax.swing.JButton();
        Gender = new javax.swing.JLabel();
        Level = new javax.swing.JLabel();
        Status = new javax.swing.JLabel();
        GenderCombo = new javax.swing.JComboBox<>();
        LevelCombo = new javax.swing.JComboBox<>();
        StatusCombo = new javax.swing.JComboBox<>();
        jScrollPane1 = new javax.swing.JScrollPane();
        MemRecordTable = new javax.swing.JTable();
        NewBtn = new javax.swing.JButton();
        RenewBtn = new javax.swing.JButton();
        EditBtn = new javax.swing.JButton();
        DeleteBtn = new javax.swing.JButton();
        lblRenewDeny = new javax.swing.JLabel();
        jLabel4 = new javax.swing.JLabel();
        jPanel3 = new javax.swing.JPanel();
        LogOutBtn = new javax.swing.JLabel();
        jLabel2 = new javax.swing.JLabel();
        jMenuBar1 = new javax.swing.JMenuBar();
        jMenu1 = new javax.swing.JMenu();
        jMenuItem1 = new javax.swing.JMenuItem();
        LogOutMenu = new javax.swing.JMenuItem();
        jMenu3 = new javax.swing.JMenu();
        jMenuItem5 = new javax.swing.JMenuItem();

        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);

        jPanel1.setBackground(new java.awt.Color(255, 255, 255));
        jPanel1.setLayout(new org.netbeans.lib.awtextra.AbsoluteLayout());

        pnlMemRecord.setBackground(new java.awt.Color(248, 248, 248));

        jLabel1.setFont(new java.awt.Font("Open Sans", 1, 30)); // NOI18N
        jLabel1.setText("Member Record");

        Search.setFont(new java.awt.Font("Open Sans", 0, 12)); // NOI18N
        Search.setForeground(java.awt.Color.gray);
        Search.setText("Search");
        Search.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusGained(java.awt.event.FocusEvent evt) {
                SearchFocusGained(evt);
            }
            public void focusLost(java.awt.event.FocusEvent evt) {
                SearchFocusLost(evt);
            }
        });
        Search.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                SearchActionPerformed(evt);
            }
        });
        Search.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                SearchKeyPressed(evt);
            }
            public void keyTyped(java.awt.event.KeyEvent evt) {
                SearchKeyTyped(evt);
            }
        });

        RefreshBtn.setBackground(new java.awt.Color(78, 173, 227));
        RefreshBtn.setFont(new java.awt.Font("Open Sans", 0, 12)); // NOI18N
        RefreshBtn.setIcon(new javax.swing.ImageIcon("C:\\Users\\Ryan's PC\\Desktop\\dataAsssss\\DataStrucAssignment\\DataStructure1\\src\\main\\java\\Icon\\reset1.png")); // NOI18N
        RefreshBtn.setText("Refresh");
        RefreshBtn.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                RefreshBtnActionPerformed(evt);
            }
        });

        Gender.setFont(new java.awt.Font("Open Sans", 1, 12)); // NOI18N
        Gender.setText("Gender :");

        Level.setFont(new java.awt.Font("Open Sans", 1, 12)); // NOI18N
        Level.setText("Level :");

        Status.setFont(new java.awt.Font("Open Sans", 1, 12)); // NOI18N
        Status.setText("Status :");

        GenderCombo.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "Male & Female", "Male", "Female" }));
        GenderCombo.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                GenderComboActionPerformed(evt);
            }
        });

        LevelCombo.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "All levels", "Gold", "Platinum", "Diamond" }));
        LevelCombo.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                LevelComboActionPerformed(evt);
            }
        });

        StatusCombo.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "Active & Inactive", "Active", "Inactive" }));
        StatusCombo.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                StatusComboActionPerformed(evt);
            }
        });

        MemRecordTable.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {

            },
            new String [] {
                "ID", "Name", "Date Of Birth", "Age", "Gender", "Contact", "Address", "Membership Level", "Date Of Joining", "Status", "Expiry Date"
            }
        ));
        MemRecordTable.setShowGrid(true);
        jScrollPane1.setViewportView(MemRecordTable);

        NewBtn.setBackground(new java.awt.Color(78, 173, 227));
        NewBtn.setFont(new java.awt.Font("Open Sans", 0, 12)); // NOI18N
        NewBtn.setIcon(new javax.swing.ImageIcon("C:\\Users\\Ryan's PC\\Desktop\\dataAsssss\\DataStrucAssignment\\DataStructure1\\src\\main\\java\\Icon\\add-user1.png")); // NOI18N
        NewBtn.setText("New");
        NewBtn.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                NewBtnActionPerformed(evt);
            }
        });

        RenewBtn.setBackground(new java.awt.Color(78, 173, 227));
        RenewBtn.setFont(new java.awt.Font("Open Sans", 0, 12)); // NOI18N
        RenewBtn.setIcon(new javax.swing.ImageIcon("C:\\Users\\Ryan's PC\\Desktop\\dataAsssss\\DataStrucAssignment\\DataStructure1\\src\\main\\java\\Icon\\third-party1.png")); // NOI18N
        RenewBtn.setText("Renew");
        RenewBtn.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusLost(java.awt.event.FocusEvent evt) {
                RenewBtnFocusLost(evt);
            }
        });
        RenewBtn.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                RenewBtnActionPerformed(evt);
            }
        });

        EditBtn.setBackground(new java.awt.Color(78, 173, 227));
        EditBtn.setFont(new java.awt.Font("Open Sans", 0, 12)); // NOI18N
        EditBtn.setIcon(new javax.swing.ImageIcon("C:\\Users\\Ryan's PC\\Desktop\\dataAsssss\\DataStrucAssignment\\DataStructure1\\src\\main\\java\\Icon\\edit1.png")); // NOI18N
        EditBtn.setText("Edit");
        EditBtn.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                EditBtnActionPerformed(evt);
            }
        });

        DeleteBtn.setBackground(new java.awt.Color(78, 173, 227));
        DeleteBtn.setFont(new java.awt.Font("Open Sans", 0, 12)); // NOI18N
        DeleteBtn.setIcon(new javax.swing.ImageIcon("C:\\Users\\Ryan's PC\\Desktop\\dataAsssss\\DataStrucAssignment\\DataStructure1\\src\\main\\java\\Icon\\delete1.png")); // NOI18N
        DeleteBtn.setText("Delete");
        DeleteBtn.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                DeleteBtnActionPerformed(evt);
            }
        });

        lblRenewDeny.setForeground(java.awt.Color.red);
        lblRenewDeny.setText("   ");

        javax.swing.GroupLayout pnlMemRecordLayout = new javax.swing.GroupLayout(pnlMemRecord);
        pnlMemRecord.setLayout(pnlMemRecordLayout);
        pnlMemRecordLayout.setHorizontalGroup(
            pnlMemRecordLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(pnlMemRecordLayout.createSequentialGroup()
                .addGap(26, 26, 26)
                .addGroup(pnlMemRecordLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(pnlMemRecordLayout.createSequentialGroup()
                        .addComponent(GenderCombo, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addGap(18, 18, 18)
                        .addComponent(LevelCombo, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addGap(18, 18, 18)
                        .addComponent(StatusCombo, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                        .addComponent(NewBtn)
                        .addGap(18, 18, 18)
                        .addComponent(RenewBtn)
                        .addGap(18, 18, 18)
                        .addComponent(EditBtn)
                        .addGap(18, 18, 18)
                        .addComponent(DeleteBtn))
                    .addGroup(pnlMemRecordLayout.createSequentialGroup()
                        .addGroup(pnlMemRecordLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addGroup(pnlMemRecordLayout.createSequentialGroup()
                                .addComponent(Search, javax.swing.GroupLayout.PREFERRED_SIZE, 154, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addGap(26, 26, 26)
                                .addComponent(RefreshBtn)
                                .addGap(221, 221, 221)
                                .addComponent(jLabel1))
                            .addGroup(pnlMemRecordLayout.createSequentialGroup()
                                .addComponent(Gender)
                                .addGap(87, 87, 87)
                                .addComponent(Level)
                                .addGap(66, 66, 66)
                                .addComponent(Status)))
                        .addGap(0, 0, Short.MAX_VALUE)))
                .addContainerGap())
            .addGroup(pnlMemRecordLayout.createSequentialGroup()
                .addComponent(jScrollPane1, javax.swing.GroupLayout.PREFERRED_SIZE, 1283, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(0, 0, Short.MAX_VALUE))
            .addGroup(pnlMemRecordLayout.createSequentialGroup()
                .addGap(416, 416, 416)
                .addComponent(lblRenewDeny)
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );
        pnlMemRecordLayout.setVerticalGroup(
            pnlMemRecordLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(pnlMemRecordLayout.createSequentialGroup()
                .addGroup(pnlMemRecordLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(pnlMemRecordLayout.createSequentialGroup()
                        .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                        .addGroup(pnlMemRecordLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                            .addComponent(Search)
                            .addComponent(RefreshBtn))
                        .addGap(18, 18, 18))
                    .addGroup(pnlMemRecordLayout.createSequentialGroup()
                        .addGap(35, 35, 35)
                        .addComponent(jLabel1)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, 44, Short.MAX_VALUE)))
                .addGroup(pnlMemRecordLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(Gender)
                    .addComponent(Level)
                    .addComponent(Status))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(pnlMemRecordLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(GenderCombo, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(LevelCombo, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(StatusCombo, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(NewBtn)
                    .addComponent(RenewBtn)
                    .addComponent(EditBtn)
                    .addComponent(DeleteBtn))
                .addGap(10, 10, 10)
                .addComponent(lblRenewDeny)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(jScrollPane1, javax.swing.GroupLayout.PREFERRED_SIZE, 325, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap())
        );

        jPanel1.add(pnlMemRecord, new org.netbeans.lib.awtextra.AbsoluteConstraints(120, 0, -1, -1));

        jLabel4.setFont(new java.awt.Font("Open Sans", 1, 14)); // NOI18N
        jLabel4.setText("Log Out");
        jPanel1.add(jLabel4, new org.netbeans.lib.awtextra.AbsoluteConstraints(32, 499, -1, -1));

        jPanel3.setBackground(new java.awt.Color(255, 255, 255));
        jPanel3.setBorder(javax.swing.BorderFactory.createTitledBorder(""));
        jPanel3.setForeground(new java.awt.Color(255, 255, 255));
        jPanel3.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseEntered(java.awt.event.MouseEvent evt) {
                jPanel3MouseEntered(evt);
            }
            public void mouseExited(java.awt.event.MouseEvent evt) {
                jPanel3MouseExited(evt);
            }
        });

        LogOutBtn.setIcon(new javax.swing.ImageIcon("C:\\Users\\Ryan's PC\\Desktop\\dataAsssss\\DataStrucAssignment\\DataStructure1\\src\\main\\java\\Icon\\exit1.png")); // NOI18N
        LogOutBtn.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                LogOutBtnMouseClicked(evt);
            }
        });

        javax.swing.GroupLayout jPanel3Layout = new javax.swing.GroupLayout(jPanel3);
        jPanel3.setLayout(jPanel3Layout);
        jPanel3Layout.setHorizontalGroup(
            jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel3Layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(LogOutBtn, javax.swing.GroupLayout.PREFERRED_SIZE, 42, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );
        jPanel3Layout.setVerticalGroup(
            jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel3Layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(LogOutBtn, javax.swing.GroupLayout.PREFERRED_SIZE, 32, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );

        jPanel1.add(jPanel3, new org.netbeans.lib.awtextra.AbsoluteConstraints(30, 440, 60, 60));

        jLabel2.setFont(new java.awt.Font("Open Sans", 1, 14)); // NOI18N
        jLabel2.setIcon(new javax.swing.ImageIcon("C:\\Users\\Ryan's PC\\Desktop\\dataAsssss\\DataStrucAssignment\\DataStructure1\\src\\main\\java\\Icon\\software-engineer1.png")); // NOI18N
        jLabel2.setText("Admin");
        jPanel1.add(jLabel2, new org.netbeans.lib.awtextra.AbsoluteConstraints(19, 47, 83, -1));

        jMenu1.setText("File");
        jMenu1.setFont(new java.awt.Font("Leelawadee UI", 0, 12)); // NOI18N

        jMenuItem1.setText("Add New Member");
        jMenuItem1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jMenuItem1ActionPerformed(evt);
            }
        });
        jMenu1.add(jMenuItem1);

        LogOutMenu.setText("Log Out");
        LogOutMenu.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                LogOutMenuActionPerformed(evt);
            }
        });
        jMenu1.add(LogOutMenu);

        jMenuBar1.add(jMenu1);

        jMenu3.setText("Help");

        jMenuItem5.setText("About");
        jMenuItem5.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jMenuItem5ActionPerformed(evt);
            }
        });
        jMenu3.add(jMenuItem5);

        jMenuBar1.add(jMenu3);

        setJMenuBar(jMenuBar1);

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(jPanel1, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(jPanel1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
        );

        pack();
        setLocationRelativeTo(null);
    }// </editor-fold>//GEN-END:initComponents

    private void SearchActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_SearchActionPerformed
        
    }//GEN-LAST:event_SearchActionPerformed
    public void setColor(JPanel p) {
        p.setBackground(new Color(255, 255, 255));
    }

    public void resetColor(JPanel p1) {
        p1.setBackground(new Color(255, 255, 255));
    }
    private void jPanel3MouseEntered(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_jPanel3MouseEntered
        setColor(jPanel3);
    }//GEN-LAST:event_jPanel3MouseEntered

    private void jPanel3MouseExited(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_jPanel3MouseExited
        resetColor(jPanel3);
    }//GEN-LAST:event_jPanel3MouseExited

    private void LogOutBtnMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_LogOutBtnMouseClicked
        String name = "LOG OUT ?";
        int result = JOptionPane.showConfirmDialog(null,
                "Are you sure you wish to log out ?", name, JOptionPane.YES_NO_OPTION);
        if (result == JOptionPane.YES_OPTION) {
            Login lg = new Login();
            lg.show();
            dispose();
        }
    }//GEN-LAST:event_LogOutBtnMouseClicked

    private void jMenuItem1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jMenuItem1ActionPerformed
       NewMember nw = new NewMember();
        nw.show();
        dispose();
    }//GEN-LAST:event_jMenuItem1ActionPerformed

    private void jMenuItem5ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jMenuItem5ActionPerformed
        About ab = new About();
        ab.show();
        dispose();
    }//GEN-LAST:event_jMenuItem5ActionPerformed

    private void LogOutMenuActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_LogOutMenuActionPerformed
        String name = "LOG OUT ?";
        int result = JOptionPane.showConfirmDialog(null,
                "Are you sure you wish to log out ?", name, JOptionPane.YES_NO_OPTION);
        if (result == JOptionPane.YES_OPTION) {
            Login lg = new Login();
            lg.show();
            dispose();
        }
    }//GEN-LAST:event_LogOutMenuActionPerformed

    private void RenewBtnActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_RenewBtnActionPerformed
        if (MemRecordTable.getSelectedRowCount() == 1) {
        dtm = (DefaultTableModel) MemRecordTable.getModel();
        
        row = MemRecordTable.getSelectedRow();
        selectedExpDate = dtm.getValueAt(row, 10).toString();
        selectedID = dtm.getValueAt(row, 0).toString();
        
        for (MemRecord mr: memRec) {
            System.out.println(mr.expDate);
            if (mr.id.equals((selectedID))) {
                now = LocalDate.now();
                dayNow = now.getDayOfMonth();
                monthNow = now.getMonthValue();
                yearNow = now.getYear();
                System.out.println(selectedExpDate);
                expDateYMD = DMYtoYMD(selectedExpDate);
                System.out.println(expDateYMD);
                
                expDateLD = LocalDate.parse(expDateYMD);
                expDateDay = expDateLD.getDayOfMonth();
                expDateMonth = expDateLD.getMonthValue();
                expDateYear = expDateLD.getYear();
                dayDiff = expDateDay - dayNow;
                monthDiff = expDateMonth - monthNow;
                yearDiff = expDateYear - yearNow;
                System.out.println(expDateLD);
                System.out.println(now);
                dueIn = Period.between(now, expDateLD);
                dueInYear = dueIn.getYears();
                if (((yearDiff == 0) && (monthDiff < 7 && monthDiff > -7)) || ((yearDiff == 1 && (((12 - monthNow) + expDateMonth) < 7))) || (yearDiff ==  -1 && ((12 - expDateMonth) + monthNow) < 7)) {
                    expDateP1YLD = expDateLD.plusYears(1);
                    expDateP1YDay = expDateP1YLD.getDayOfMonth();
                    expDateP1YMonth = expDateP1YLD.getMonthValue();
                    expDateP1YYear = expDateP1YLD.getYear();
                    expDateP1Y = dateDMY(expDateP1YDay, expDateP1YMonth, expDateP1YYear);
                    mr.status = "ACTIVE";
                    mr.expDate = expDateP1Y;
                    dtm.setValueAt(mr.status, row, 9);
                    dtm.setValueAt(mr.expDate, row, 10);
                    
                    lblRenewDeny.setText("   ");
                } else if ((yearDiff == 0 && ((expDateMonth - monthNow) > 6)) || ((yearDiff == 1) && (((12 - monthNow) + expDateMonth) > 6))) {  
                    lblRenewDeny.setText("Renewal is allowed only when the expiry date is due in less than 6 months.");
                } else {
                    yn = JOptionPane.showConfirmDialog(rootPane, "This membership has been inactive for too long, to active it, member has to pay the amount of registration fee of his/her membership level instead of renewal fee.\nDo you want to activate " + mr.id + "?");
                    if (yn == JOptionPane.YES_OPTION) {
                        expDateP1YLD = now.plusYears(1);
                        expDateP1YDay = expDateP1YLD.getDayOfMonth();
                        expDateP1YMonth = expDateP1YLD.getMonthValue();
                        expDateP1YYear = expDateP1YLD.getYear();
                        expDateP1Y = dateDMY(expDateP1YDay, expDateP1YMonth, expDateP1YYear);
                        mr.status = "ACTIVE";
                        mr.expDate = expDateP1Y;
                        dtm.setValueAt(mr.status, row, 9);
                        dtm.setValueAt(mr.expDate, row, 10);
                    }
                }
            }
        
        }
        
        File deleteFile = new File("memberRecord.txt");
            if (deleteFile.delete()) {
                System.out.print("Deleted");
            } else {}
        
        
        try {
            
            File create = new File("memberRecord.txt");
            if (create.createNewFile()) {}
                    FileWriter myWriter = new FileWriter("memberRecord.txt");
                    myWriter.write("");
                    myWriter.close();
                    FileWriter myWriter2 = new FileWriter("memberRecord.txt", true);
                    FileReader myObj = new FileReader("memberRecord.txt");
                    Scanner scanner = new Scanner(myObj);
                    for (MemRecord mr: memRec) {
                        if (!scanner.hasNextLine()) {
                            myWriter2.write(mr.toString() + "\n");
                        }
                        } 
                    scanner.close();
                    myWriter2.close();
                } catch (IOException e) {
                        
                        }
        }
    }//GEN-LAST:event_RenewBtnActionPerformed

    private void EditBtnActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_EditBtnActionPerformed
        if (MemRecordTable.getSelectedRowCount() == 1) {
            row = MemRecordTable.getSelectedRow();
            selectedID = dtm.getValueAt(row, 0).toString();
            
            for (MemRecord mr: memRec) {
                if (mr.id.equals(selectedID)) {
                    try {
                        File file = new File("editRecord.txt");
                        if (file.createNewFile()) {
                            System.out.println("File created: " + file.getName());
                        } else {
                            System.out.println("File already exists.");
                        }
                    } catch (IOException e) {
                        System.out.println("An error occured.");
                        e.printStackTrace();
                    }
                    
                    try {
                        FileWriter myWriter = new FileWriter("editRecord.txt");
                        myWriter.write(mr.id);
                        myWriter.close();
                    } catch (IOException e) {
                        e.printStackTrace();
                    }
                }
            }
            
            dispose();
            
            em = new EditMember();
            em.show();
        }
    }//GEN-LAST:event_EditBtnActionPerformed

    private void NewBtnActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_NewBtnActionPerformed
        dispose();
        
        nm = new NewMember();
        nm.show();
    }//GEN-LAST:event_NewBtnActionPerformed

    private void DeleteBtnActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_DeleteBtnActionPerformed
        if (MemRecordTable.getSelectedRowCount() == 1) {
            row = MemRecordTable.getSelectedRow();
            selectedID = dtm.getValueAt(row, 0).toString();
            yn = JOptionPane.showConfirmDialog(rootPane, "Delete member " + selectedID + "?");
            if (yn == JOptionPane.YES_OPTION) {
                dtm.removeRow(row);
                for (int i = 0; i < memRec.size(); i++) {
                    if (memRec.get(i).id.equals(selectedID)) {
                        memRec.remove(i);
                    }
                }
                
                try {
                    FileWriter myWriter = new FileWriter("memberRecord.txt");
                    for (MemRecord mr: memRec) {
                        myWriter.write(mr.toString() + "\n");
                    }
                    myWriter.close();
                } catch (IOException e) {
                    System.out.print("An error occured.");
                    e.printStackTrace();
                }
            }
            
        }
        
    }//GEN-LAST:event_DeleteBtnActionPerformed

    private void SearchKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_SearchKeyPressed
        
    }//GEN-LAST:event_SearchKeyPressed

    private void SearchFocusGained(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_SearchFocusGained
        if (Search.getText().equals("Search")) {
            Search.setText("");
            Search.setForeground(Color.black);
        }
    }//GEN-LAST:event_SearchFocusGained

    private void SearchFocusLost(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_SearchFocusLost
        if (Search.getText().equals("")) {
            Search.setText("Search");
            Search.setForeground(Color.gray);
        }
    }//GEN-LAST:event_SearchFocusLost

    private void RefreshBtnActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_RefreshBtnActionPerformed
        Search.setText("Search");
        Search.setForeground(Color.gray);
        dtm.setRowCount(0);
        sorter.setRowFilter(null);
        for (MemRecord mr: memRec) {
            lineSplit = mr.toString().split("___");
            dtm.addRow(lineSplit);
        }
    }//GEN-LAST:event_RefreshBtnActionPerformed

    private void SearchKeyTyped(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_SearchKeyTyped
        search = Search.getText();
        if ((search.length() == 0)) {
            sorter.setRowFilter(null);
        } else {
            sorter.setRowFilter(RowFilter.regexFilter(search));
        }
    }//GEN-LAST:event_SearchKeyTyped

    private void GenderComboActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_GenderComboActionPerformed
        sort();
    }//GEN-LAST:event_GenderComboActionPerformed

    private void LevelComboActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_LevelComboActionPerformed
        sort();
    }//GEN-LAST:event_LevelComboActionPerformed

    private void StatusComboActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_StatusComboActionPerformed
        sort();
    }//GEN-LAST:event_StatusComboActionPerformed

    private void RenewBtnFocusLost(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_RenewBtnFocusLost
        lblRenewDeny.setText("   ");
    }//GEN-LAST:event_RenewBtnFocusLost

    public MemRecord(String id, String name, String dob, String age, String gender, String contactNum, String address, String memLvl, String doj, String status, String expDate) {
        this.id = id;
        this.name = name;
        this.dob = dob;
        this.age = age;
        this.gender = gender;
        this.contactNum = contactNum;
        this.address = address;
        this.memLvl = memLvl;
        this.doj = doj;
        this.status = status;
        this.expDate = expDate;
    }

    private String id, selectedID, name, dob, dobLDFormatString, dateDMY, dateYMD, age, gender, contactNum, address, memLvl, doj, status, expDate, expDateString, expDateYMD, expDateP1Y, selectedExpDate, line, search;
    private int dueInMonth, dayNow, dayP1Y, expDateDay, dayDiff, monthNow, monthP1Y, expDateMonth, monthDiff, yearNow, yearP1Y, ageInt, expDateYear, dueInYear, yearDiff, expDateP1YDay, expDateP1YMonth, expDateP1YYear, row, column, yn;
    private NewMember nm;
    private String[] lineSplit;
    private Object[] lineArr, focus;
    private LinkedList<MemRecord> memRec;
    private MemRecord mr;
    private EditMember em;
    private DefaultTableModel dtm;
    private BufferedReader br;
    private LocalDate now, dobLDFormat, expDateLD, expDateP1YLD;
    private Period dueIn, ageP;
    private Object expDateObj;
    private TableRowSorter<DefaultTableModel> sorter;
    
    public String toString() {
        return id + "___" + name + "___" + dob + "___" + age + "___" + gender + "___" + contactNum + "___" + address + "___" + memLvl + "___" + doj + "___" + status + "___" + expDate;
    }
    
    private String DMYtoYMD(String dateDMY) {
        dateYMD = String.valueOf(dateDMY.charAt(6)) + String.valueOf(dateDMY.charAt(7)) + String.valueOf(dateDMY.charAt(8)) + String.valueOf(dateDMY.charAt(9)) + String.valueOf(dateDMY.charAt(2)) + String.valueOf(dateDMY.charAt(3)) + String.valueOf(dateDMY.charAt(4)) + String.valueOf(dateDMY.charAt(2)) + String.valueOf(dateDMY.charAt(0)) + String.valueOf(dateDMY.charAt(1));
        return dateYMD;
    }
    
    private String dateDMY(int day, int month, int year) {
        
        if (day < 10 || month < 10) {
            if (day < 10 && month < 10) {
                dateDMY = "0" + day + "-0" + month + "-" + year;
            } else if (day < 10) {
                dateDMY = "0" + day + "-" + month + "-" + year;
            } else if (month < 10) {
                dateDMY = day + "-0" + month + "-" + year;
            }
        } else {
            dateDMY = day + "-" + month + "-" + year;
        }
        
        return dateDMY;
    }
    
    private void sort() {
        dtm.setRowCount(0);
        
        for (MemRecord mr: memRec) {
            
        }
        
        gender = GenderCombo.getSelectedItem().toString();
        memLvl = LevelCombo.getSelectedItem().toString();
        status = StatusCombo.getSelectedItem().toString();
        
        if (!gender.equals("Male & Female")) {
            for (int i = 0; i < memRec.size();) {
                if (!memRec.get(i).gender.equalsIgnoreCase(gender)) {
                    memRec.remove(i);
                } else {
                    i++;
                }
            }
        }
        
        if (!memLvl.equals("All levels")) {
            for (int i = 0; i < memRec.size();) {
                System.out.println(memRec.get(i));
                
                if (!memRec.get(i).memLvl.equalsIgnoreCase(memLvl)) {
                    memRec.remove(i);
                } else {
                    i++;
                }
                
            }
            
        }
        
        if (!status.equals("Active & Inactive")) {
            for (int i = 0; i < memRec.size();) {
                if (!memRec.get(i).status.equalsIgnoreCase(status)) {
                    memRec.remove(i);
                } else {
                    i++;
                }
            }
        }
        
        for (MemRecord mr: memRec) {
            line = mr.toString();
            lineSplit = line.split("___");
            dtm.addRow(lineSplit);
        }
        
        memRec.removeAll(memRec);
        
        try {
            File myObj = new File("memberRecord.txt");
            Scanner scanner = new Scanner(myObj);
            while (scanner.hasNextLine()) {
                line = scanner.nextLine();
                lineSplit = line.split("___");
                memRec.add(new MemRecord(lineSplit[0], lineSplit[1], lineSplit[2], lineSplit[3], lineSplit[4], lineSplit[5], lineSplit[6], lineSplit[7], lineSplit[8], lineSplit[9], lineSplit[10]));
            }
            scanner.close();
        } catch (FileNotFoundException e) {
            System.out.println("An error occured.");
            e.printStackTrace();
        }
        
        for (MemRecord mr: memRec) {
        }
    }
    
    /**
     * @param args the command line arguments
     */
    public static void main(String args[]) {
        /* Set the Nimbus look and feel */
        //<editor-fold defaultstate="collapsed" desc=" Look and feel setting code (optional) ">
        /* If Nimbus (introduced in Java SE 6) is not available, stay with the default look and feel.
         * For details see http://download.oracle.com/javase/tutorial/uiswing/lookandfeel/plaf.html 
         */
        try {
            for (javax.swing.UIManager.LookAndFeelInfo info : javax.swing.UIManager.getInstalledLookAndFeels()) {
                if ("Nimbus".equals(info.getName())) {
                    javax.swing.UIManager.setLookAndFeel(info.getClassName());
                    break;
                }
            }
        } catch (ClassNotFoundException ex) {
            java.util.logging.Logger.getLogger(MemRecord.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (InstantiationException ex) {
            java.util.logging.Logger.getLogger(MemRecord.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (IllegalAccessException ex) {
            java.util.logging.Logger.getLogger(MemRecord.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (javax.swing.UnsupportedLookAndFeelException ex) {
            java.util.logging.Logger.getLogger(MemRecord.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        }
        //</editor-fold>

        /* Create and display the form */
        java.awt.EventQueue.invokeLater(new Runnable() {
            public void run() {
                new MemRecord().setVisible(true);
            }
        });
    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton DeleteBtn;
    private javax.swing.JButton EditBtn;
    private javax.swing.JLabel Gender;
    private javax.swing.JComboBox<String> GenderCombo;
    private javax.swing.JLabel Level;
    private javax.swing.JComboBox<String> LevelCombo;
    private javax.swing.JLabel LogOutBtn;
    private javax.swing.JMenuItem LogOutMenu;
    private javax.swing.JTable MemRecordTable;
    private javax.swing.JButton NewBtn;
    private javax.swing.JButton RefreshBtn;
    private javax.swing.JButton RenewBtn;
    private javax.swing.JTextField Search;
    private javax.swing.JLabel Status;
    private javax.swing.JComboBox<String> StatusCombo;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel4;
    private javax.swing.JMenu jMenu1;
    private javax.swing.JMenu jMenu3;
    private javax.swing.JMenuBar jMenuBar1;
    private javax.swing.JMenuItem jMenuItem1;
    private javax.swing.JMenuItem jMenuItem5;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JPanel jPanel3;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JLabel lblRenewDeny;
    private javax.swing.JPanel pnlMemRecord;
    // End of variables declaration//GEN-END:variables
}
